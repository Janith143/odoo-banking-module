<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- Transaction Form View -->
        <record id="view_bank_transaction_form" model="ir.ui.view">
            <field name="name">bank.transaction.form</field>
            <field name="model">bank.transaction</field>
            <field name="arch" type="xml">
                <form string="Bank Transaction" create="false" edit="false">
                    <header>
                        <button name="action_complete" string="Complete" type="object" 
                                class="oe_highlight" invisible="status != 'pending'" 
                                groups="odoo_bank.group_bank_teller"/>
                        <button name="action_reverse" string="Reverse" type="object" 
                                invisible="status != 'completed'" 
                                groups="odoo_bank.group_bank_manager"/>
                        <button name="action_cancel" string="Cancel" type="object" 
                                invisible="status not in ['draft', 'pending']" 
                                groups="odoo_bank.group_bank_teller"/>
                        <field name="status" widget="statusbar" 
                               statusbar_visible="draft,pending,completed"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1><field name="transaction_number" readonly="1"/></h1>
                        </div>
                        <group>
                            <group string="Transaction Details">
                                <field name="transaction_date"/>
                                <field name="transaction_type"/>
                                <field name="account_id"/>
                                <field name="customer_id"/>
                            </group>
                            <group string="Amount">
                                <field name="currency_id" invisible="1"/>
                                <field name="amount" widget="monetary"/>
                                <field name="balance_before" widget="monetary"/>
                                <field name="balance_after" widget="monetary"/>
                            </group>
                        </group>
                        <group>
                            <field name="description" placeholder="Transaction description..."/>
                            <field name="reference"/>
                        </group>
                        <group>
                            <group>
                                <field name="transfer_id" readonly="1"/>
                                <field name="loan_id" readonly="1"/>
                            </group>
                            <group>
                                <field name="is_reconciled"/>
                                <field name="reconciliation_date" invisible="not is_reconciled"/>
                            </group>
                        </group>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>
        
        <!-- Transaction Tree View -->
        <record id="view_bank_transaction_tree" model="ir.ui.view">
            <field name="name">bank.transaction.tree</field>
            <field name="model">bank.transaction</field>
            <field name="arch" type="xml">
                <list string="Transactions" create="false">
                    <field name="transaction_date"/>
                    <field name="transaction_number"/>
                    <field name="account_id"/>
                    <field name="customer_id"/>
                    <field name="transaction_type"/>
                    <field name="amount" widget="monetary" 
                           decoration-success="transaction_type in ['deposit', 'transfer_in', 'interest']"
                           decoration-danger="transaction_type in ['withdrawal', 'transfer_out', 'fee']"/>
                    <field name="currency_id" column_invisible="1"/>
                    <field name="balance_after" widget="monetary"/>
                    <field name="status" widget="badge" 
                           decoration-success="status == 'completed'"
                           decoration-warning="status == 'pending'"
                           decoration-danger="status == 'failed'"/>
                    <field name="reference"/>
                </list>
            </field>
        </record>
        
        <!-- Transaction Search View -->
        <record id="view_bank_transaction_search" model="ir.ui.view">
            <field name="name">bank.transaction.search</field>
            <field name="model">bank.transaction</field>
            <field name="arch" type="xml">
                <search string="Search Transactions">
                    <field name="transaction_number"/>
                    <field name="account_id"/>
                    <field name="customer_id"/>
                    <field name="reference"/>
                    <filter string="Today" name="today" 
                            domain="[('transaction_date', '&gt;=', datetime.datetime.now().replace(hour=0, minute=0, second=0)), 
                                     ('transaction_date', '&lt;=', datetime.datetime.now().replace(hour=23, minute=59, second=59))]"/>
                    <filter string="This Month" name="this_month" 
                            domain="[('transaction_date', '&gt;=', datetime.datetime.now().replace(day=1, hour=0, minute=0, second=0))]"/>
                    <filter string="Deposits" name="deposits" 
                            domain="[('transaction_type', '=', 'deposit')]"/>
                    <filter string="Withdrawals" name="withdrawals" 
                            domain="[('transaction_type', '=', 'withdrawal')]"/>
                    <filter string="Completed" name="completed" 
                            domain="[('status', '=', 'completed')]"/>
                    <group>
                        <filter string="Transaction Type" name="group_type" 
                                context="{'group_by': 'transaction_type'}"/>
                        <filter string="Account" name="group_account" 
                                context="{'group_by': 'account_id'}"/>
                        <filter string="Date" name="group_date" 
                                context="{'group_by': 'transaction_date:day'}"/>
                    </group>
                </search>
            </field>
        </record>
        
        <!-- Transaction Action -->
        <record id="action_bank_transaction" model="ir.actions.act_window">
            <field name="name">Transactions</field>
            <field name="res_model">bank.transaction</field>
            <field name="view_mode">list,form</field>
            <field name="context">{'search_default_this_month': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No transactions found
                </p>
                <p>
                    All account transactions will appear here.
                </p>
            </field>
        </record>
        
    </data>
</odoo>
